# 版本0.8开发计划：测试覆盖与质量保障

## 版本目标
**完成度：约10%** - 测试体系尚未建立，需要在修复基础问题后进行

建立完整的测试体系，全面提升代码质量和系统可靠性。实现后端单元测试、集成测试、前端组件测试和端到端测试，设立测试覆盖率阈值和自动化CI流程，确保主要业务逻辑、核心API和关键交互都有充分的测试保障，为系统的稳定运行和持续迭代提供坚实基础。

**当前状态**：目前系统存在大量编译错误和TypeScript错误，必须先修复这些基础问题才能开始建立测试体系。

---

## 任务Checklist

### TASK001 基础问题修复（前置任务）
- 版本：0.8
- 状态：🔴 紧急待处理
- 子任务：
  - 🔴 修复Go后端编译错误（特别是漏洞扫描模块Target类型冲突）
  - 🔴 修复前端902个TypeScript错误
  - 🔴 修复Svelte 5 runes语法错误
  - 🔴 确保系统可以正常编译和运行
- AI提示词-原：
  > 修复所有编译错误和TypeScript错误，确保系统可以正常运行
- AI提示词-补充：
  > 这是测试工作的前置条件，必须先确保代码能正常编译和运行
- 验收标准：
  - Go后端编译无错误
  - 前端TypeScript检查通过
  - Svelte应用可以正常启动和运行
  - 所有主要功能页面可以访问
- 注意事项：
  - 修复Target类型冲突时不能破坏现有功能
  - Svelte 5语法升级要保持功能一致性
  - TypeScript错误修复要确保类型安全

---

### TASK002 后端单元测试补全
- 版本：0.8
- 状态：❌ 等待基础问题修复后执行
- 子任务：
  - ❌ 梳理internal/各模块（api、models、services、utils等）核心函数与业务逻辑，列出需补全单元测试的清单
  - ❌ 在对应包下新建*_test.go文件，使用Go testing标准库为核心函数编写单元测试
  - ❌ 引入Testify等断言库，提升测试可读性与表达力
  - ❌ 覆盖正常、异常、边界等分支，mock外部依赖（如数据库、网络）
  - ❌ 统计单元测试覆盖率，输出报告
- AI提示词-原：
  > 梳理internal/api、models、services、utils等目录下的核心函数，列出需补全单元测试的清单。在每个包下新建*_test.go文件，使用Go testing标准库和Testify断言库为主要业务逻辑编写单元测试。测试需覆盖正常、异常、边界分支，mock外部依赖。统计并输出测试覆盖率报告。
- AI提示词-补充：
  > 1. 单元测试需独立、可重复运行，禁止依赖真实数据库或外部服务。
  > 2. 推荐使用GoMock、Testify/mock等工具mock接口依赖。
  > 3. 所有新代码必须配套单元测试，历史代码逐步补全。
- 验收标准：
  - internal/各模块均有*_test.go文件
  - 主要业务逻辑单元测试覆盖率≥80%
  - 测试可独立运行，mock外部依赖
- 注意事项：
  - 禁止在单元测试中操作真实数据库
  - 测试用例需自动化运行

---

### TASK003 后端集成测试
- 版本：0.8
- 状态：❌ 等待基础问题修复后执行
- 子任务：
  - ❌ 设计覆盖主要API路由的集成测试用例，模拟HTTP请求与响应
  - ❌ 使用httptest等工具，测试API端点的完整流程
  - ❌ 覆盖认证、资产、项目、任务等核心API
  - ❌ 校验响应结构、状态码、错误处理等
  - ❌ 集成测试可在CI中自动运行
- AI提示词-原：
  > 使用Go的httptest包为主要API路由（如/auth、/assets、/projects等）编写集成测试，模拟HTTP请求，校验响应结构、状态码、错误处理。测试需覆盖认证、资产、项目、任务等核心API。集成测试可在CI流程中自动运行。
- AI提示词-补充：
  > 1. 集成测试需独立于生产数据库，可用内存数据库或mock。
  > 2. 推荐分层组织测试用例，便于维护。
- 验收标准：
  - 主要API路由均有集成测试覆盖
  - 响应结构、状态码校验完整
  - 测试可自动化运行
- 注意事项：
  - 集成测试环境需与生产隔离
  - 测试数据需可控、可清理

---

### TASK004 前端单元与组件测试补全
- 版本：0.8
- 状态：❌ 等待基础问题修复后执行
- 子任务：
  - ❌ 梳理web/src/lib、routes等目录下的核心store、组件、工具函数，列出需补全测试的清单
  - ❌ 使用Vitest、@testing-library/svelte为主要store、组件、工具函数补全单元/组件测试
  - ❌ mock API请求、localStorage等外部依赖
  - ❌ 覆盖正常、异常、边界分支
  - ❌ 统计测试覆盖率，输出报告
- AI提示词-原：
  > 梳理web/src/lib、routes等目录下的核心store、组件、工具函数，列出需补全测试的清单。使用Vitest、@testing-library/svelte为主要store、组件、工具函数补全单元/组件测试。mock API请求、localStorage等外部依赖。统计测试覆盖率，输出报告。
- AI提示词-补充：
  > 1. 所有新组件/模块必须配套单元测试，历史代码逐步补全。
  > 2. 推荐为复杂交互、状态变更、边界场景编写测试。
- 验收标准：
  - 主要store、组件、工具函数均有测试覆盖
  - 单元/组件测试覆盖率≥80%
  - 测试可自动化运行
- 注意事项：
  - 禁止直接操作真实API
  - mock依赖需可控、可清理

---

### TASK005 前端端到端（E2E）测试
- 版本：0.8
- 状态：❌ 等待基础问题修复后执行
- 子任务：
  - ❌ 选型并集成Cypress或Playwright等E2E测试工具
  - ❌ 编写覆盖主要用户流程（如登录、资产管理、项目管理等）的E2E测试用例
  - ❌ 配置测试环境与mock服务，确保测试独立可控
  - ❌ 在package.json中补充E2E测试脚本
  - ❌ E2E测试可在CI中自动运行
- AI提示词-原：
  > 选型并集成Cypress或Playwright等E2E测试工具。为主要用户流程（如登录、资产管理、项目管理等）编写E2E测试用例。配置mock服务，确保测试独立可控。在package.json中补充E2E测试脚本。E2E测试可在CI中自动运行。
- AI提示词-补充：
  > 1. 推荐优先覆盖认证、资产、项目等高频业务流程。
  > 2. E2E测试需支持本地与CI环境运行。
- 验收标准：
  - 主要用户流程均有E2E测试覆盖
  - E2E测试脚本可一键运行
  - 测试可在CI自动化执行
- 注意事项：
  - 测试环境需与生产隔离
  - mock服务需可控、可清理

---

### TASK006 测试覆盖率统计与阈值
- 版本：0.8
- 状态：❌ 等待基础问题修复后执行
- 子任务：
  - ❌ 配置Go和Vitest的覆盖率统计工具
  - ❌ 设定后端、前端测试覆盖率阈值（如80%）
  - ❌ 在CI流程中强制校验覆盖率
  - ❌ 输出覆盖率报告，便于追踪
- AI提示词-原：
  > 配置Go和Vitest的覆盖率统计工具，设定后端、前端测试覆盖率阈值（如80%）。在CI流程中强制校验覆盖率，输出覆盖率报告。
- AI提示词-补充：
  > 1. 覆盖率报告需易于追踪和分析。
  > 2. 阈值未达标时CI应阻断合并。
- 验收标准：
  - 后端、前端均有覆盖率报告
  - 阈值校验自动化
  - 覆盖率达标方可合并
- 注意事项：
  - 覆盖率统计需真实、准确
  - 阈值可根据实际逐步提升

---

### TASK007 CI集成与自动化
- 版本：0.8
- 状态：❌ 等待基础问题修复后执行
- 子任务：
  - ❌ 配置CI（如GitHub Actions）自动执行后端、前端所有测试
  - ❌ 集成覆盖率校验、E2E测试、报告输出
  - ❌ 测试失败或覆盖率不达标时阻断CI
  - ❌ 输出测试报告，便于追踪
- AI提示词-原：
  > 配置CI（如GitHub Actions）自动执行后端、前端所有测试，集成覆盖率校验、E2E测试、报告输出。测试失败或覆盖率不达标时阻断CI。输出测试报告，便于追踪。
- AI提示词-补充：
  > 1. CI流程需支持本地与远程一致性。
  > 2. 测试报告建议自动上传或归档。
- 验收标准：
  - CI可自动执行所有测试
  - 失败或覆盖率不达标时自动阻断
  - 测试报告可追溯
- 注意事项：
  - CI配置需文档化
  - 本地与CI环境需一致

---

### TASK008 测试相关文档与验收
- 版本：0.8
- 状态：❌ 等待基础问题修复后执行
- 子任务：
  - ❌ 在README.md补充测试相关说明，包含测试结构、工具、运行方式、覆盖率、CI集成等
  - ❌ 在DEV_PLAN.md中补充测试相关开发计划与验收标准
  - ❌ 持续更新测试用例与文档，保持与实现同步
  - ❌ 补充测试验收标准，便于自查与复核
- AI提示词-原：
  > 在README.md补充测试相关说明，内容包括测试结构、工具、运行方式、覆盖率、CI集成等。补充DEV_PLAN.md中测试相关开发计划与验收标准。持续更新测试用例与文档，保持与实现同步。补充测试验收标准，便于自查与复核。
- AI提示词-补充：
  > 1. 文档需结构清晰，内容详实，便于新成员快速上手。
  > 2. 测试用例与文档需持续同步更新。
- 验收标准：
  - 文档结构清晰，内容详实
  - 测试用例与文档同步
  - 验收标准明确
- 注意事项：
  - 文档需持续更新
  - 测试用例需自动化运行

---

Checklist:
1. 🔴 基础问题修复 - 紧急待处理，测试工作的前置条件
2. ❌ 后端单元测试完善 - 等待编译错误修复后开始
3. ❌ 后端集成测试完善 - 依赖于单元测试完成
4. ❌ 前端组件测试完善 - 等待TypeScript错误和Svelte 5语法修复
5. ❌ 端到端测试实现 - 需要系统整体功能稳定后开始
6. ❌ 测试覆盖率管理与监控 - 依赖于所有测试类型完成
7. ❌ CI/CD集成与自动化 - 最后集成步骤
8. ❌ 测试文档与最佳实践 - 伴随测试实现同步编写 