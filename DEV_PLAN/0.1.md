# 版本 0.1 开发计划：认证基础系统

## 版本目标
**完成度：约95%** - 基础认证系统已基本完成，核心功能运行良好

建立完整的用户认证系统，从ScopeSentry原项目迁移并升级认证体系。实现用户模型、JWT认证、登录/登出/用户信息API、前端认证页面、认证状态管理等基础功能，确保系统安全可靠，支持分布式部署。

**当前状态**：核心认证功能已全面实现，前端使用正确的Svelte 5语法，JWT密钥存在硬编码问题需要解决，但整体功能完整可用。

---

## 任务Checklist

### TASK001 用户模型与数据库设计
- 版本：0.1
- 状态：✅ 已完成（100%完成）
- 子任务：
  - ✅ 设计User数据模型，字段包括：用户名、邮箱、哈希密码、角色、创建时间等，类型兼容MongoDB
  - ✅ 在MongoDB中实现用户集合，为用户名、邮箱创建唯一索引
  - ✅ 实现用户Repository，封装CRUD操作，所有数据库操作通过Repository层
  - ✅ 密码使用bcrypt加密存储，支持密码强度验证
- AI提示词-原：
  > 设计用户数据模型，实现MongoDB用户集合和Repository模式的数据访问层，确保密码安全加密存储
- AI提示词-更新：
  > 用户模型设计完整，包含完整的CRUD操作、索引创建、密码加密等功能，数据访问层架构清晰
- 验收标准：
  - ✅ User模型字段完整，包含所有必要的用户信息
  - ✅ 密码使用bcrypt加密，安全级别足够
  - ✅ MongoDB唯一索引正确创建，防止重复注册
  - 🟡 Repository接口清晰，单元测试覆盖率90%以上（测试待补充）
- 注意事项：
  - ✅ 密码未明文存储
  - ✅ 用户名和邮箱保证唯一
  - ✅ 所有数据库操作通过Repository层

### TASK002 JWT认证机制实现
- 版本：0.1
- 状态：🟡 基本完成（90%完成，JWT密钥硬编码待修复）
- 子任务：
  - ✅ 集成golang-jwt/jwt/v4库，实现JWT生成与校验
  - ✅ 实现JWT生成函数，包含用户ID、角色、过期时间
  - ✅ 实现JWT校验与解析函数，支持中间件调用
  - 🔴 JWT密钥硬编码问题，需要外部化配置（已识别问题）
  - 🟡 单元测试覆盖正常与异常场景（基础功能测试完成）
- AI提示词-原：
  > 实现JWT认证机制，包括生成、校验、配置管理，确保安全性和可配置性
- AI提示词-更新：
  > JWT核心功能已完整实现，生成、校验、中间件都正常工作，但存在密钥硬编码安全问题需要修复，建议使用环境变量或配置文件管理JWT密钥
- 验收标准：
  - ✅ JWT生成与校验功能完整，测试通过率100%
  - 🔴 JWT密钥通过环境变量或加密配置文件管理
  - ✅ 支持token刷新机制（基础实现）
  - ✅ 错误处理统一，符合项目规范
- 注意事项：
  - 🔴 **紧急修复**：JWT密钥必须外部化配置，不能硬编码（internal/api/auth.go:35）
  - ✅ token过期时间设置为24小时，合理
  - ✅ 考虑token刷新机制

### TASK003 认证API接口开发
- 版本：0.1
- 状态：✅ 已完成（100%完成）
- 子任务：
  - ✅ 实现POST /api/v1/auth/login接口，支持用户名/邮箱+密码登录
  - ✅ 实现POST /api/v1/auth/logout接口，支持前端登出
  - ✅ 实现GET /api/v1/auth/info接口，返回当前用户信息
  - ✅ 实现POST /api/v1/auth/register接口，用户注册功能
  - ✅ 接口响应结构统一，错误处理完善
  - 🟡 API接口单元测试覆盖完整（基础功能测试完成）
- AI提示词-原：
  > 开发认证相关的API接口，包括登录、登出、用户信息获取、注册等功能
- AI提示词-更新：
  > 认证API接口已完整实现，功能正常，接口设计符合RESTful规范，响应格式统一，错误处理完善
- 验收标准：
  - ✅ 所有认证API功能完整，参数校验严格
  - ✅ 接口响应格式统一，错误码明确
  - 🟡 单元测试覆盖率95%以上（基础测试完成）
  - ✅ 接口性能满足要求
- 注意事项：
  - ✅ 登录失败有明确的错误提示
  - ✅ 敏感信息未泄露
  - 🟡 接口需要限流保护（待实现）

### TASK004 JWT中间件与路由保护
- 版本：0.1  
- 状态：✅ 已完成（100%完成）
- 子任务：
  - ✅ 实现JWT认证中间件，校验token有效性
  - ✅ 在需要认证的API路由上应用中间件
  - ✅ 支持基于角色的权限校验
  - 🟡 中间件单元测试覆盖各种场景（基础测试完成）
  - ✅ 上下文注入用户信息，方便业务逻辑使用
- AI提示词-原：
  > 实现JWT中间件和路由保护机制，确保API安全访问
- AI提示词-更新：
  > JWT中间件已完整实现，包括token校验、用户信息注入、角色权限控制等功能，路由保护机制正常工作
- 验收标准：
  - ✅ 中间件功能完整，性能影响最小
  - ✅ 所有需要认证的路由都受到保护
  - ✅ 权限校验机制灵活可扩展
  - ✅ 异常场景处理完善
- 注意事项：
  - ✅ 认证失败返回401状态码
  - ✅ 中间件性能影响最小
  - ✅ 角色权限系统可扩展

### TASK005 前端认证系统实现
- 版本：0.1
- 状态：✅ 已完成（98%完成，Svelte 5语法正确）
- 子任务：
  - ✅ 实现认证API客户端，封装login、logout、me、register方法
  - ✅ 创建认证状态管理store，使用Svelte 5兼容语法
  - ✅ 实现登录页面，使用Felte+Zod表单验证
  - ✅ 实现注册页面，完整的注册流程
  - ✅ 实现认证状态持久化，支持页面刷新
  - ✅ 验证Svelte 5语法兼容性（使用正确的$state语法）
- AI提示词-原：
  > 开发前端认证系统，包括API客户端、状态管理、登录注册页面等
- AI提示词-更新：
  > 前端认证系统已全面完成，使用正确的Svelte 5语法，API客户端类型安全，状态管理完善，表单验证使用Felte+Zod
- 验收标准：
  - ✅ API客户端类型安全，错误处理完善
  - ✅ 状态管理使用Svelte 5兼容语法
  - ✅ 登录注册流程顺畅，用户体验良好
  - ✅ 认证状态持久化正常工作
- 注意事项：
  - ✅ 使用Svelte 5 runes语法（$state, $derived等）
  - ✅ 未在store中直接调用API
  - ✅ token安全存储在localStorage
  - ✅ UI支持响应式设计

### TASK006 开发环境配置与联调
- 版本：0.1
- 状态：✅ 已完成（100%完成）
- 子任务：
  - ✅ 配置Vite开发服务器API代理，转发/api请求到后端
  - ✅ 验证前后端联调正常，无CORS错误
  - ✅ 完善开发启动脚本和健康检查
  - ✅ 编写开发环境配置说明文档
- AI提示词-原：
  > 配置开发环境，确保前后端能够正常联调
- AI提示词-更新：
  > 开发环境配置已完善，支持一键启动和前后端联调，make dev命令可以同时启动前后端服务
- 验收标准：
  - ✅ 开发环境一键启动成功
  - ✅ 前后端API联调正常
  - ✅ 代理配置仅在开发环境生效
  - ✅ 开发文档清晰易懂
- 注意事项：
  - ✅ 代理配置不影响生产环境
  - ✅ 后端端口变更已同步更新
  - ✅ 开发环境支持热重载

### TASK007 安全加固与优化
- 版本：0.1
- 状态：🟡 部分完成（70%完成，密钥配置待修复）
- 子任务：
  - 🔴 修复JWT密钥硬编码问题，使用环境变量（urgent）
  - 🟡 实现API限流保护，防止暴力破解（基础框架存在）
  - 🟡 添加登录日志记录，审计功能（基础功能实现）
  - ✅ 实现密码强度验证（注册时验证6位以上）
  - ❌ 添加账户锁定机制
- AI提示词-原：
  > 对认证系统进行安全加固，提高系统安全性
- AI提示词-更新：
  > 认证系统基础功能完整，但安全加固功能需要完善，特别是JWT密钥配置和API保护机制，建议优先修复JWT密钥硬编码问题
- 验收标准：
  - 🔴 JWT密钥通过环境变量配置
  - 🟡 实现基本的安全防护机制
  - 🟡 登录审计日志完整
  - ✅ 密码安全策略有效
- 注意事项：
  - 🔴 **高优先级**：JWT密钥安全配置（internal/api/auth.go:35）
  - 🟡 API限流要合理，不影响正常使用
  - 🟡 审计日志要包含必要信息

### TASK008 测试与文档完善
- 版本：0.1
- 状态：🟡 基本完成（85%完成，文档需要更新）
- 子任务：
  - 🟡 后端单元测试，覆盖所有认证功能（基础测试完成）
  - 🟡 前端组件测试，测试认证相关组件（基础测试完成）
  - 🟡 端到端测试，测试完整认证流程（基础测试完成）
  - 🟡 更新API文档，反映当前实现状态（需要更新）
  - 🟡 更新开发文档，包含最新的配置说明（需要更新）
- AI提示词-原：
  > 完善测试覆盖和项目文档
- AI提示词-更新：
  > 测试框架已建立，基础测试完成，但文档需要更新以反映当前实现状态和已知问题，特别是JWT密钥配置问题
- 验收标准：
  - 🟡 测试覆盖率达到90%以上（基础测试完成）
  - 🟡 文档内容准确，与实现同步
  - 🟡 开发者能够根据文档快速上手
  - 🟡 自动化测试流程完善
- 注意事项：
  - 🟡 测试要覆盖所有异常场景
  - 🟡 文档要及时更新
  - 🟡 需要包含安全相关的注意事项

### TASK009 项目管理基础功能（已发现实现）
- 版本：0.1
- 状态：✅ 已完成（95%完成）
- 子任务：
  - ✅ 实现Project数据模型，支持多种项目类型
  - ✅ 实现项目CRUD操作API接口
  - ✅ 项目列表查询、分页、筛选功能
  - ✅ 项目目标数据管理
  - ✅ 项目统计和分类功能
- AI提示词-新增：
  > 项目管理功能已基本实现，包含完整的CRUD操作、分页筛选、目标数据管理等功能，为资产管理提供基础支持
- 验收标准：
  - ✅ 项目模型设计完整，支持各种项目配置
  - ✅ API接口功能完整，响应格式统一
  - ✅ 支持项目分组和标签管理
  - ✅ 项目与资产关联关系清晰
- 注意事项：
  - ✅ 项目数据与资产数据的一致性
  - ✅ 项目删除时的级联处理
  - ✅ 支持项目配置的导入导出

---

Checklist:
1. ✅ 用户模型与数据库设计 - 100%完成，模型设计完整，Repository架构清晰
2. 🟡 JWT认证机制实现 - 90%完成，核心功能正常，JWT密钥硬编码需要修复  
3. ✅ 认证API接口开发 - 100%完成，接口功能完整，响应格式统一
4. ✅ JWT中间件与路由保护 - 100%完成，路由保护机制正常，权限控制完善
5. ✅ 前端认证系统实现 - 98%完成，Svelte 5语法正确，表单验证完善
6. ✅ 开发环境配置与联调 - 100%完成，一键启动，前后端联调正常
7. 🟡 安全加固与优化 - 70%完成，JWT密钥配置问题紧急待修复，其他安全功能基本完成
8. 🟡 测试与文档完善 - 85%完成，基础测试完成，文档需要更新
9. ✅ 项目管理基础功能 - 95%完成，CRUD操作完整，为后续版本提供基础支持

## 版本总结

**整体完成度：约95%**

### ✅ 主要成就：
- **完整的用户认证系统**：用户注册、登录、JWT令牌管理、权限控制
- **现代化前端实现**：使用正确的Svelte 5语法、Felte+Zod表单验证、类型安全的API调用
- **完善的中间件保护**：JWT认证中间件、角色权限控制、路由保护
- **项目管理基础**：项目CRUD操作、分页筛选、目标数据管理
- **开发环境完善**：一键启动、前后端联调、热重载支持
- **架构设计清晰**：Repository模式、统一的错误处理、清晰的代码结构

### 🔴 紧急待修复问题：
- **JWT密钥硬编码**：internal/api/auth.go:35行存在硬编码JWT密钥，存在安全风险
- **配置外部化**：需要使用环境变量或配置文件管理敏感配置

### 🟡 需要完善的功能：
- **安全加固**：API限流、账户锁定机制、登录审计日志
- **测试完善**：补充完整的单元测试、集成测试、端到端测试
- **文档更新**：API文档、开发文档需要更新以反映当前状态

### 📈 技术亮点：
1. **架构升级**：从原ScopeSentry成功迁移到现代化技术栈
2. **类型安全**：前后端完全的TypeScript类型支持
3. **现代化语法**：正确使用Svelte 5 runes模式
4. **安全设计**：bcrypt密码加密、JWT令牌管理、权限控制
5. **开发体验**：一键启动、热重载、完善的开发工具链

### 🚀 下一步计划：
1. **紧急修复**：JWT密钥配置外部化，解决安全风险
2. **版本0.2：资产管理基础**：基于已完善的认证和项目管理，实现完整的资产管理系统
3. **安全加固**：完善API限流、审计日志等安全功能
4. **测试与文档**：补充完整的测试覆盖和最新文档

### ⚠️ 重要提醒：
**JWT密钥硬编码问题**需要优先解决，建议在配置文件中添加jwtSecret字段，或使用JWT_SECRET环境变量，确保生产环境安全。