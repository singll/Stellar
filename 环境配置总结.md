# Stellar 环境配置总结

## 🔧 配置变更总结

### 网络配置变更
- **服务监听地址**: 从 `localhost` 改为 `0.0.0.0`
- **后端服务**: 监听 `0.0.0.0:8090`
- **前端服务**: 监听 `0.0.0.0:5173`
- **API代理**: 前端代理目标改为 `http://0.0.0.0:8090`

### 数据库连接变更
- **MongoDB**: 使用外部服务 `192.168.7.216:27017`
- **Redis**: 使用外部服务 `192.168.7.128:6379`
- **环境隔离**: 通过不同数据库名和Redis db号区分

## 📊 环境配置对比

| 环境 | 配置文件 | MongoDB数据库 | Redis DB | 服务模式 | 用途 |
|------|----------|---------------|----------|----------|------|
| 生产 | `config.yaml` | `stellarserver` | db: 0 | release | 生产环境 |
| 开发 | `config.dev.yaml` | `stellarserver_dev` | db: 1 | debug | 日常开发 |
| 测试 | `config.test.yaml` | `stellarserver_test` | db: 2 | debug | 自动化测试 |

## 🚀 启动方式对比

### 开发环境启动
```bash
# 方式一：Makefile（推荐）
make dev

# 方式二：手动启动
go run ./cmd/main.go -config config.dev.yaml -log-level debug
cd web && pnpm run dev

# 方式三：并发启动
cd web && pnpm run dev:fullstack
```

### 生产环境启动
```bash
# 使用生产配置
go run ./cmd/main.go -config config.yaml -log-level info

# 或构建后启动
make build
./stellar-server -config config.yaml
```

### 测试环境启动
```bash
# 使用测试配置
go run ./cmd/main.go -config config.test.yaml -log-level debug
```

## 🔗 数据库连接配置

### MongoDB连接
```yaml
mongodb:
  uri: "mongodb://192.168.7.216:27017"
  user: "admin"
  password: "admin"
  database: "stellarserver_[env]"  # 根据环境变化
```

### Redis连接
```yaml
redis:
  addr: "192.168.7.128:6379"
  password: "redis"
  db: [0|1|2]  # 生产/开发/测试
```

## 🌐 网络访问地址

### 开发环境
- **后端API**: `http://0.0.0.0:8090/api/v1/`
- **前端界面**: `http://0.0.0.0:5173`
- **WebSocket**: `ws://0.0.0.0:8090/ws`

### 生产环境
- **后端API**: `http://0.0.0.0:8090/api/v1/`
- **静态文件**: 嵌入在Go二进制文件中
- **WebSocket**: `ws://0.0.0.0:8090/ws`

## 📈 性能参数对比

| 参数 | 生产环境 | 开发环境 | 测试环境 |
|------|----------|----------|----------|
| MongoDB连接池 | 100-10 | 20-5 | 10-2 |
| Redis连接池 | 100-10 | 20-5 | 10-2 |
| 任务并发数 | 10 | 8 | 3 |
| 扫描并发数 | 100 | 50 | 10 |
| 任务超时 | 1小时 | 1小时 | 5分钟 |
| 重试次数 | 3次 | 3次 | 1次 |

## 🔒 安全配置

### JWT密钥
- **生产环境**: `stellarserver-secret-key`
- **开发环境**: `stellarserver-dev-secret-key-change-in-production`
- **测试环境**: `stellarserver-test-secret-key`

### 数据库访问
- **用户名**: `admin`
- **密码**: `admin` (应在生产环境使用环境变量)
- **Redis密码**: `redis`

## 🐳 容器化支持

### Docker部署优势
- ✅ **0.0.0.0监听**: 支持容器内外访问
- ✅ **环境隔离**: 通过配置文件区分环境
- ✅ **数据库分离**: 不同环境使用不同数据库
- ✅ **网络配置**: 便于负载均衡和反向代理

### 推荐Docker配置
```dockerfile
# 后端服务
EXPOSE 8090
CMD ["./stellar-server", "-config", "config.yaml"]

# 前端服务
EXPOSE 5173
CMD ["npm", "run", "dev"]
```

## 📝 迁移检查清单

### ✅ 已完成的配置变更
- [x] 服务监听地址改为0.0.0.0
- [x] 数据库连接改为外部服务
- [x] 环境数据库名称区分
- [x] Redis db号环境隔离
- [x] 前端代理配置更新
- [x] 启动脚本更新
- [x] 文档更新

### ⚠️ 需要注意的事项
1. **防火墙配置**: 0.0.0.0监听需要配置防火墙规则
2. **数据库权限**: 确保外部数据库可以访问
3. **环境变量**: 生产环境建议使用环境变量管理敏感信息
4. **备份策略**: 不同环境数据库需要独立备份策略

### 🔄 后续优化建议
1. **环境变量化**: 数据库连接信息使用环境变量
2. **健康检查**: 添加数据库连接健康检查
3. **监控告警**: 数据库连接状态监控
4. **自动化部署**: 基于配置文件的自动化部署

## 📚 相关配置文件

- `config.yaml` - 生产环境配置
- `config.dev.yaml` - 开发环境配置  
- `config.test.yaml` - 测试环境配置
- `web/vite.config.ts` - 前端代理配置
- `web/package.json` - 前端启动脚本
- `Makefile` - 构建和启动脚本