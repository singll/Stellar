# Stellar（星绽）开发计划总览

本文件为Stellar（星绽）项目的开发蓝图与任务导航，指导开发者与AI助手分阶段、分任务推进项目重构。

---

## 1. 项目简介
Stellar（星绽）是基于ScopeSentry项目的Go+Svelte全新重构版，定位为分布式安全资产管理与漏洞扫描平台。后端采用Go+Gin+MongoDB+Redis，前端采用Svelte 5+SvelteKit+TypeScript+shadcn-svelte+Tailwind CSS。

---

## 2. 版本路线图（2025-01-08 优化版）

### 主要版本规划
- **0.1**：认证基础、用户模型、JWT、登录/登出/用户信息API、前端登录页、认证状态管理  ✅ **【状态：基本完成95%】**
- **0.2**：资产管理基础、资产模型、资产API、前端资产列表页  ❓ **【状态：架构完整75%，业务逻辑待完善】**
- **0.3**：项目管理完善、任务管理核心、节点管理基础  ❗️ **【状态：部分实现，任务系统是关键】**
- **0.4**：核心安全扫描功能 - 子域名枚举、端口扫描、漏洞扫描基础  ❌ **【状态：架构30%，执行逻辑待实现】**
- **0.5**：插件系统完善、监控系统、敏感信息检测  ❌ **【状态：插件架构40%，其他未开始】**
- **0.6**：功能完善与用户体验优化  ❌ **【状态：未开始】**
- **0.7**：性能优化与分布式增强  ❌ **【状态：未开始】**
- **0.8**：测试覆盖与质量保障  ❌ **【状态：未开始】**
- **0.9**：文档完善与部署优化  ❌ **【状态：未开始】**
- **1.0**：生产就绪的完全重构版本  ❌ **【状态：未开始】**

### 关键里程碑与依赖关系

#### 🔴 关键路径分析
```
认证系统 (✅ 完成) 
    ↓
项目管理 (✅ 基本完成) 
    ↓
任务管理系统 (❗️ 关键瓶颈) ← 🚨 当前阻塞点
    ↓
扫描功能 (❌ 等待任务系统) 
    ↓
插件系统 (❓ 架构就绪)
    ↓
生产就绪 (❌ 远期目标)
```

#### 📊 版本完成度评估
| 版本 | 计划功能 | 实际完成度 | 主要问题 | 调整建议 |
|------|----------|------------|----------|----------|
| 0.1 | 认证基础 | ✅ 95% | JWT密钥硬编码 | 🟡 安全配置修复 |
| 0.2 | 资产管理 | ❓ 75% | 业务逻辑不完整 | 🟡 优先完善CRUD |
| 0.3 | 任务/项目/节点 | ❗️ 35% | 任务调度引擎缺失 | 🔴 重点突破 |
| 0.4 | 核心扫描 | ❌ 30% | 依赖任务系统 | 🔴 架构先行 |
| 0.5+ | 高级功能 | ❌ 10% | 基础功能优先 | 🟢 后续规划 |

### 调整后的开发节奏

#### 🎯 近期目标（Q1 2025）
1. **v0.2 完善**：资产管理CRUD完整实现
2. **v0.3 突破**：任务管理系统执行引擎
3. **安全修复**：JWT密钥、配置外部化

#### 🚀 中期目标（Q2 2025）  
1. **v0.4 核心**：第一个可用的扫描功能（子域名枚举）
2. **功能扩展**：端口扫描、基础漏洞检测
3. **前端完善**：扫描结果可视化

#### 📈 长期目标（Q3-Q4 2025）
1. **v0.5-0.7**：插件系统、监控、性能优化
2. **v0.8-0.9**：测试覆盖、文档、部署优化  
3. **v1.0**：生产就绪交付

---

## 3. 任务编号与状态说明
- 任务编号：TASK001、TASK002……
- 状态类型：
  - 计划中：尚未开始开发
  - 进行中：当前正在开发
  - 已完成：全部子任务已完成
  - 部分实现（❓）：已有部分实现，但未完全达标（如部分功能已开发但未满足全部验收标准或AI提示词要求）
- 每个TASK和子任务需标记当前状态
- 【唯一进行中规则】：同一阶段（如0.1）下，任何时刻只能有一个TASK处于"进行中"状态，其余均为"计划中"或"已完成"。

---

## 4. 目录导航
- [DEV_PLAN/0.1.md](DEV_PLAN/0.1.md) 认证基础
- [DEV_PLAN/0.2.md](DEV_PLAN/0.2.md) 资产管理
- [DEV_PLAN/0.3.md](DEV_PLAN/0.3.md) 项目/任务/节点管理
- [DEV_PLAN/0.4.md](DEV_PLAN/0.4.md) 漏洞/端口/子域名扫描
- [DEV_PLAN/0.5.md](DEV_PLAN/0.5.md) 插件/监控/敏感信息
- [DEV_PLAN/0.6.md](DEV_PLAN/0.6.md) 功能完善
- [DEV_PLAN/0.7.md](DEV_PLAN/0.7.md) 性能优化
- [DEV_PLAN/0.8.md](DEV_PLAN/0.8.md) 测试覆盖
- [DEV_PLAN/0.9.md](DEV_PLAN/0.9.md) 文档补全
- [DEV_PLAN/1.0.md](DEV_PLAN/1.0.md) 完全重构

---

## 5. 任务拆分与验收标准说明
- 以功能模块为主线，每个模块按后端、前端、集成、测试、文档等维度细分
- 每个子任务需细化到可直接实现的最小单元
- 每个子任务后附详细AI提示词，确保AI助手可独立实现
- 每个TASK需有明确的验收标准和注意事项，便于自查和复核

---

## 6. 注意事项与开发规范
- 严格遵循项目分层结构、唯一API实例、状态管理分离、统一错误处理、RESTful API设计、Repository模式等规范
- 参考原项目ScopeSentry-main与ScopeSentry-UI-main功能，逐步迁移与重构
- DEV_PLAN需动态维护，开发推进时及时更新任务状态、补充新任务、完善验收标准与注意事项 

---

## 7. 子计划文件格式规范

为保证所有 DEV_PLAN/x.md 子计划格式高度一致，便于团队协作与自动化校验，现制定如下强制规范：

### 7.1 章节与标题层级
- 每个 DEV_PLAN/x.md 必须包含以下章节，且顺序不可变：
  1. `# 版本X.X开发计划：xxx`（一级标题，描述本阶段主题）
  2. `## 版本目标`（二级标题，简要说明本阶段目标）
  3. 分割线 `---`
  4. `## 任务Checklist`（二级标题，所有任务分解）
  5. 多个 `### TASK00X xxx`（三级标题，每个核心任务）
  6. 每个 TASK 下依次包含：版本号、状态、子任务、AI提示词-原/补充、验收标准、注意事项
  7. 结尾必须有 `Checklist:` 显式编号列表，内容与 TASK 顺序一一对应

### 7.2 TASK 结构模板
每个 TASK 必须严格包含以下字段，顺序不可变：

```md
### TASK00X 任务名称
- 版本：X.X
- 状态：计划中/进行中/已完成/部分实现（❓/❌/✅/❓）
- 子任务：
  - [emoji] 子任务1
  - [emoji] 子任务2
- AI提示词-原：
  > ...
- AI提示词-补充：
  > ...
- 验收标准：
  - 标准1
  - 标准2
- 注意事项：
  - 注意1
  - 注意2
```

### 7.3 emoji 使用规范
- 子任务前必须加 emoji，含义如下：
  - ✅ 已完成
  - ❌ 未完成
  - ❓ 部分实现/需补充
- 状态字段建议与 emoji 保持一致

- 【强制】所有子任务前的emoji仅允许使用以下三种：
  - ✅ 已完成
  - ❌ 未完成/计划中
  - ❓ 部分实现/需补充
- 禁止自定义emoji（如🟦、🟩等），如需扩展，须在本节补充说明并全局统一。
- Checklist与子任务emoji、状态字段保持一致。
- 计划中/未完成统一用❌，部分实现用❓，已完成用✅。

### 7.4 AI提示词引用格式
- 必须用 Markdown 引用块 `>`，分为"原"和"补充"两部分，内容可为空但结构不可省略

### 7.5 Checklist 结尾要求
- 每个 DEV_PLAN/x.md 结尾必须有如下格式 Checklist，与 TASK 顺序一一对应：

```md
Checklist:
1. [任务1简述]
2. [任务2简述]
...
n. [任务n简述]
```

### 7.6 格式校验建议
- 推荐使用 Markdown 校验脚本，自动检查章节、标题、Checklist、emoji、引用块等是否符合规范

### 7.7 扩展区说明
- 如需特殊说明或扩展内容，统一放在每个 TASK 的"注意事项"末尾，主结构不可变

> 本规范经团队评审通过后，后续所有 DEV_PLAN/x.md 必须严格按此模板维护。

---

## 8. 当前项目状态总结（2025-01-08 深度分析更新）

### 8.1 整体重构进度评估
- **总体完成度**: 约28-32%（基于详细代码分析调整）
- **技术栈迁移**: Go后端 + Svelte 5前端 基础架构完成度90%
- **核心功能状态**: 认证系统完成95%，项目管理80%，资产管理70%，安全扫描功能架构30%

### 8.2 已实现功能模块详细状态

#### ✅ 认证系统 (完成度: 95%) - 生产就绪
**架构亮点**:
- 完整的JWT生成与校验机制 (`internal/utils/jwt.go`)
- 基于角色的权限控制中间件 (`internal/api/auth.go`)
- 类型安全的前端API客户端 (`web/src/lib/api/auth.ts`)
- 统一错误处理和token自动刷新

**已实现核心功能**:
- 用户注册/登录/登出完整流程
- JWT密钥管理与配置化
- 前端认证状态管理（Svelte 5 runes）
- 开发环境API代理配置

**API 端点完整性**:
- `POST /api/v1/auth/login` - 用户登录（支持用户名/邮箱）
- `POST /api/v1/auth/register` - 用户注册
- `POST /api/v1/auth/logout` - 用户登出
- `GET /api/v1/auth/info` - 获取用户信息（需认证）

**前端状态管理**:
- 基于 Svelte 5 runes 的响应式状态管理
- localStorage 持久化存储
- 自动令牌刷新机制
- 统一错误处理和用户反馈

**安全特性**:
- bcrypt 密码加密存储
- JWT 令牌24小时有效期
- 基于角色的访问控制
- 完整的输入验证和错误处理

**测试覆盖**:
- 后端认证API单元测试
- 前端认证服务单元测试
- 端到端测试覆盖完整登录流程
- 中间件权限验证测试

**文档完整性**:
- API文档包含完整的认证接口说明
- 前端状态管理使用示例
- 认证流程图和错误处理说明
- 开发环境配置指南

**待完善**:
- JWT密钥环境变量化（当前硬编码）
- token刷新机制完善
- 密码重置功能

#### ✅ 项目管理 (完成度: 85%) - 基本可用  
**已实现**:
- 完整的项目CRUD API (`internal/api/project.go`)
- 项目统计与数据聚合
- 前端项目管理页面
- 完整的TypeScript类型定义

**架构特点**:
- Repository模式数据访问层
- RESTful API设计
- 前后端类型同步

**待完善**:
- 项目成员管理功能
- 项目活动日志
- 项目归档与导出

#### ❓ 资产管理基础 (完成度: 75%) - 架构完整，业务逻辑待完善
**已实现**:
- 多类型资产模型设计 (`internal/models/asset.go`)
- 基础CRUD API框架
- 前端资产列表页面
- 资产分类与标签系统

**架构优势**:
- 支持多种资产类型（Domain、IP、Port、URL等）
- 灵活的元数据存储
- 变更历史追踪设计

**待完善**:
- 资产关系映射
- 资产变更历史实现
- 批量操作与导入导出

### 8.3 部分实现功能模块深度分析

#### ❓ 任务管理系统 (完成度: 35%) - 架构完整，执行引擎部分实现
**已实现亮点**:
- 完整的任务数据模型 (`internal/models/task.go`)
- 任务状态管理与流转
- API路由框架 (`internal/api/task.go`)
- 分布式任务调度架构设计

**技术特点**:
```go
// 发现的优秀实现示例
type TaskManager struct {
    db        *mongo.Database
    redis     *redis.Client
    scheduler *cron.Cron
    executor  *TaskExecutor
}
```

**缺失的关键组件**:
- 任务队列管理器
- 任务进度实时跟踪
- 任务依赖关系处理
- 失败重试机制

**优先级**: 🔴 极高 - 整个平台的调度核心

#### ❓ 节点管理系统 (完成度: 25%) - 基础框架完整
**已实现**:
- 节点注册与发现机制
- 节点状态数据模型
- 基础API接口

**缺失关键功能**:
- 节点健康检查与心跳
- 负载均衡算法
- 节点故障转移

**优先级**: 🟡 中高 - 分布式架构支撑

#### ❓ 插件系统 (完成度: 40%) - 架构设计优秀
**已实现亮点**:
- 完整的插件架构设计 (`internal/plugin/`)
- 沙箱执行机制 (`internal/plugin/sandbox.go`)
- 插件元数据管理
- 多语言插件支持框架

**技术亮点**:
```go
// 发现的优秀设计
type PluginManager struct {
    registry    *PluginRegistry
    loader      *PluginLoader
    sandbox     *Sandbox
    metaStore   *MetadataStore
}
```

**缺失功能**:
- 插件执行引擎完善
- 插件市场机制
- 插件安全验证

### 8.4 核心安全扫描功能状态分析

#### ❓ 子域名枚举 (完成度: 30%) - 架构完整，执行逻辑部分实现
**已发现的实现**:
- 子域名枚举服务框架
- DNS解析器实现
- 并发控制机制

**发现的技术亮点**:
```go
// internal/services/subdomain/enum.go
type SubdomainEnumerator struct {
    resolver    *DNSResolver
    config      models.SubdomainEnumConfig
    taskManager *TaskManager
}
```

**缺失组件**:
- 字典爆破引擎完善
- 结果去重与验证
- 与任务系统深度集成

#### ❓ 端口扫描 (完成度: 25%) - 基础框架存在
**已实现**:
- 端口扫描任务模型
- 基础扫描逻辑
- API接口框架

**缺失关键功能**:
- 服务识别与指纹识别
- 高并发扫描优化
- 扫描结果处理与存储

#### ❌ 漏洞扫描 (完成度: 15%) - 仅有架构框架
**现状**:
- 基础API接口存在
- POC执行引擎架构设计
- 漏洞数据模型

**急需实现**:
- POC执行引擎
- 漏洞规则管理
- 扫描报告生成

### 8.5 技术架构深度评估

#### 🟢 架构优势
**后端架构**:
- ✅ 清晰的分层架构（API → Service → Model → Database）
- ✅ Repository模式数据访问层
- ✅ 统一的错误处理机制
- ✅ 完整的配置管理系统

**前端架构**:
- ✅ Svelte 5 + runes现代状态管理
- ✅ 类型安全的API客户端
- ✅ 组件库基于shadcn-svelte
- ✅ 响应式设计支持

#### 🟡 当前不足分析

**配置管理问题**:
```yaml
# config.yaml 硬编码问题
mongodb:
  uri: "mongodb://192.168.7.216:27017"  # 需要环境变量化
redis:
  addr: "192.168.7.128:6379"            # 需要环境变量化
```

**依赖注入复杂化**:
```go
// cmd/main.go 依赖过多
api.RegisterAPIRoutes(router, db, redisClient, cfg, 
    nodeManager, taskManager, vulnEngine, vulnHandler, 
    vulnRegistry, portScanTaskManager, pluginManager, 
    pluginStore, monitoringService, discoveryHandlerForAPI, 
    sensitiveHandler) // 参数过多，需要重构
```

**测试覆盖不足**:
- 单元测试覆盖率约20%
- 缺少集成测试
- 端到端测试不完整

### 8.6 性能与安全问题发现

#### 🔴 安全隐患
```go
// internal/utils/jwt.go 硬编码密钥
var JWTSecret = []byte("StellarServer-JWT-Secret")  // 高危！
```

**其他安全问题**:
- 输入验证不完整
- SQL注入防护待加强
- 文件上传安全验证缺失

#### 🔴 性能瓶颈
- 数据库查询缺少索引优化
- 大数据量分页性能问题
- 前端虚拟滚动未实现
- 并发控制机制需要优化

### 8.7 下一阶段开发重点（基于深度分析）

#### 🔴 第一优先级 - 核心功能完善
1. **任务管理系统执行引擎** - 影响所有扫描功能
2. **子域名枚举完整实现** - 第一个可用的安全功能
3. **安全配置修复** - JWT密钥、数据库连接外部化
4. **错误处理统一化** - 提升用户体验

#### 🟡 第二优先级 - 功能扩展
1. **端口扫描服务识别** - 完善安全检测能力
2. **漏洞扫描POC执行** - 核心安全能力
3. **前端扫描结果可视化** - 用户体验提升
4. **API文档完善** - 开发体验提升

#### 🟢 第三优先级 - 系统完善
1. **插件系统执行引擎** - 扩展性支撑
2. **监控告警系统** - 运维支撑
3. **测试覆盖提升** - 质量保障
4. **性能优化** - 生产准备

### 8.8 风险评估与缓解策略

#### 🔴 高风险
**开发量估算不准确**: 
- 风险：剩余70%工作量可能超出预期
- 缓解：分阶段交付，MVP优先

**技术复杂度高**:
- 风险：分布式任务调度、插件沙箱等技术挑战
- 缓解：参考成熟开源方案，渐进式实现

#### 🟡 中等风险
**兼容性挑战**:
- 风险：与原ScopeSentry数据格式兼容性
- 缓解：数据迁移脚本，兼容性测试

**团队技能匹配**:
- 风险：Go并发编程、Svelte 5新特性学习曲线
- 缓解：技术培训，代码review

### 8.9 建议开发策略（优化版）

#### 1. 分阶段交付策略
- **Phase 1 (v0.2-0.3)**: 核心扫描功能基础实现
- **Phase 2 (v0.4-0.5)**: 完整扫描功能与插件系统
- **Phase 3 (v0.6-1.0)**: 性能优化与生产化

#### 2. 技术债务管理
- 每个版本分配20%时间用于重构
- 强制代码review与测试覆盖
- 定期架构评审与优化

#### 3. 质量保证策略
- 单元测试覆盖率目标80%
- 每个功能模块独立集成测试
- 自动化CI/CD流程

#### 4. 风险监控机制
- 每周技术风险评估
- 关键路径依赖管理
- 备选方案准备 