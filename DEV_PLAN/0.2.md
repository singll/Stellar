# 版本0.2开发计划：资产管理基础

## 版本目标
- 完成资产模型、资产API、前端资产列表页等基础资产管理功能，兼容原ScopeSentry项目核心资产管理能力，采用强类型、RESTful、可扩展设计。

---

## 任务Checklist

### TASK001 资产数据模型与数据库
- 版本：0.2
- 状态：✅ 基本完成（待优化）
- 子任务：
  - ✅ 设计并完善多类型资产结构体（DomainAsset、SubdomainAsset、IPAsset、PortAsset、URLAsset、HTTPAsset、AppAsset、MiniAppAsset），字段需覆盖host、ip、port、service、type、tags、metadata、变更历史等，兼容原项目数据。
  - ❓ 实现资产变更历史（AssetChange）与资产关系（AssetRelation）结构体。
  - ✅ 资产集合名动态生成，支持多类型分表。
  - ❓ 单元测试覆盖模型序列化、反序列化、字段校验。
- AI提示词-原：
  > 在internal/models/asset.go中，定义多类型资产结构体，字段需兼容原ScopeSentry asset表，支持变更历史与关系。集合名需可动态生成，便于分表。
- AI提示词-补充：
  > 
- 验收标准：
  - 资产结构体字段完整，类型准确，兼容原有数据。
  - 变更历史、关系结构体实现无误。
  - 单元测试覆盖常用场景。
- 注意事项：
  - 字段命名需与前端、原项目保持一致。
  - 资产类型需可扩展。

---

### TASK002 资产Repository与数据库操作
- 版本：0.2
- 状态：✅ 基本完成（待完善）
- 子任务：
  - ✅ 实现资产Repository，封装各类型资产的CRUD操作，所有数据库操作必须通过该层。
  - ❓ 支持分页、筛选、排序、批量操作。
  - ❌ 单元测试覆盖常用操作与异常分支。
- AI提示词-原：
  > 在internal/models/asset_repository.go中，采用Repository模式封装资产的CRUD、批量、分页、筛选等操作，所有数据库操作必须通过该层。
- AI提示词-补充：
  > 
- 验收标准：
  - Repository接口清晰，单元测试覆盖常用操作。
- 注意事项：
  - 禁止在业务逻辑中直接操作数据库。

---

### TASK003 资产API接口实现
- 版本：0.2
- 状态：✅ 已完成
- 子任务：
  - ✅ 在internal/api/asset.go中实现/assets RESTful接口，支持GET（列表/详情）、POST（创建）、PUT（更新）、DELETE（删除）、批量、导入导出、关系管理等。
  - ✅ 参数、返回结构需与前端、原项目兼容。
  - ✅ 支持分页、筛选、模糊查询、标签、类型、项目归属等。
  - ✅ 错误处理需统一，返回结构需标准化。
  - ❌ 单元测试覆盖所有接口分支。
- AI提示词-原：
  > 在internal/api/asset.go中，注册/assets相关RESTful路由，实现CRUD、批量、导入导出、关系管理等接口，参数与返回结构需兼容前端与原项目。
- AI提示词-补充：
  > 
- 验收标准：
  - API接口功能完整，参数校验严格。
  - 返回结构与前端、原项目兼容。
  - 单元测试覆盖所有分支。
- 注意事项：
  - 禁止硬编码Magic String，所有常量需集中管理。
  - 错误处理需统一。

---

### TASK004 前端资产API服务封装
- 版本：0.2
- 状态：✅ 基本完成
- 子任务：
  - ✅ 在web/src/lib/api/asset.ts中，封装getAssets、getAssetById、createAsset、updateAsset、deleteAsset、scanAsset等方法，所有请求均复用api实例。
  - ✅ 类型定义与后端结构同步，参数、返回值需类型安全。
  - ✅ 错误需统一抛出APIError。
  - ❌ 单元测试覆盖主要分支。
- AI提示词-原：
  > 在web/src/lib/api/asset.ts中，封装资产相关API方法，所有请求均复用api实例，类型定义需与后端同步，错误需统一处理。
- AI提示词-补充：
  > 
- 验收标准：
  - API服务方法参数、返回类型明确。
  - 仅复用唯一api实例。
  - 错误处理统一。
- 注意事项：
  - 禁止直接用fetch或新建axios实例。
  - 类型定义需与后端同步。

---

### TASK005 前端资产列表页实现
- 版本：0.2
- 状态：✅ 基础完成（功能待完善）
- 子任务：
  - ✅ 在web/src/routes/(app)/assets/+page.svelte中实现资产列表页，支持分页、筛选、表格展示、标签、类型、项目归属等。
  - ✅ 调用assetApi服务获取数据，类型定义需与后端同步。
  - ✅ UI需兼容移动端，采用shadcn-svelte+Tailwind CSS。
  - ✅ 状态管理与数据获取分离，store仅负责状态。
  - ❓ 错误与加载状态需友好提示。
  - ❌ 单元测试与端到端测试覆盖主要分支。
- AI提示词-原：
  > 在web/src/routes/(app)/assets/+page.svelte中，使用assetApi获取资产列表，支持分页、筛选、表格展示，UI需兼容移动端，类型定义与后端同步。
- AI提示词-补充：
  > 
- 验收标准：
  - 列表页交互流畅，分页、筛选准确。
  - UI兼容移动端。
  - 测试覆盖主要分支。
- 注意事项：
  - 禁止在store中直接调用API。
  - UI需兼容移动端。

---

### TASK006 资产详情页与变更历史
- 版本：0.2
- 状态：✅ 已完成
- 子任务：
  - ✅ 在web/src/routes/(app)/assets/[id]/+page.svelte中实现资产详情页，展示资产核心字段、变更历史、标签、项目归属等。
  - ✅ 支持变更历史的分页、筛选、展示。
  - ✅ 类型定义与后端同步。
  - ✅ UI需兼容移动端。
  - ❌ 单元测试与端到端测试覆盖主要分支。
- AI提示词-原：
  > 在web/src/routes/(app)/assets/[id]/+page.svelte中，展示资产详情与变更历史，类型定义与后端同步，UI需兼容移动端。
- AI提示词-补充：
  > 
- 验收标准：
  - 详情页信息完整，变更历史展示准确。
  - UI兼容移动端。
  - 测试覆盖主要分支。
- 注意事项：
  - 类型定义需与后端同步。

---

### TASK007 资产管理相关文档与验收
- 版本：0.2
- 状态：计划中
- 子任务：
  - ❌ 在README.md中补充资产管理模块说明，包括API、数据结构、前后端交互、状态管理方案等。
  - ❌ 在DEV_PLAN.md中补充资产管理相关开发计划与验收标准。
  - ❌ 补充单元测试与端到端测试用例，确保自动化运行。
  - ❌ 文档需持续更新，保持与实现同步。
- AI提示词-原：
  > 在README.md中补充资产管理模块说明，DEV_PLAN.md中补充开发计划与验收标准，测试用例需自动化运行，文档需持续更新。
- AI提示词-补充：
  > 
- 验收标准：
  - 文档结构清晰，内容详实。
  - 测试用例覆盖率高。
  - 验收标准明确。
- 注意事项：
  - 文档需持续更新，保持与实现同步。
  - 测试用例需自动化运行。

---

Checklist:
1. [✅ 设计并完善多类型资产结构体，兼容原有数据，支持变更历史与关系 - 已完成]
2. [✅ 实现资产Repository，封装CRUD、批量、分页、筛选等操作 - 已完成]
3. [✅ 实现/assets RESTful接口，支持CRUD、批量、导入导出、关系管理等 - 已完成]
4. [✅ 前端封装资产API服务，类型定义与后端同步，错误统一处理 - 已完成]
5. [✅ 实现资产列表页，支持分页、筛选、表格展示，UI兼容移动端 - 基础完成，功能待完善]
6. [✅ 实现资产详情页与变更历史，类型定义同步，UI兼容移动端 - 已完成]
7. [❌ 补充资产管理相关文档、开发计划与自动化测试用例 - 计划中] 