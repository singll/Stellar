// æ¼æ´ä¸¥é‡æ€§çº§åˆ«
export type VulnerabilitySeverity = 'critical' | 'high' | 'medium' | 'low' | 'info';

// æ¼æ´çŠ¶æ€
export type VulnerabilityStatus =
	| 'unverified'
	| 'verified'
	| 'fixed'
	| 'false_positive'
	| 'ignored';

// æ¼æ´ç±»å‹
export type VulnerabilityType = 'web' | 'system' | 'network' | 'config' | 'component';

// POCè„šæœ¬ç±»å‹
export type POCScriptType = 'yaml' | 'python' | 'go' | 'nuclei' | 'javascript';

// POCæ¨¡å‹
export interface POC {
	id: string;
	name: string;
	description: string;
	author: string;
	references: string[];
	cveId: string;
	cweId: string;
	severity: VulnerabilitySeverity;
	type: VulnerabilityType;
	category: string;
	script: string;
	scriptType: POCScriptType;
	createdAt: string;
	updatedAt: string;
	tags: string[];
	enabled: boolean;
	requiredParams: string[];
	defaultParams: Record<string, string>;
	successRate: number;
	runCount: number;
	successCount: number;
	failCount: number;
}

// POCæ‰§è¡Œç»“æœ
export interface POCResult {
	id: string;
	taskId: string;
	pocId: string;
	pocName: string; // æ·»åŠ  pocName å±æ€§
	target: string;
	targetUrl: string; // æ·»åŠ  targetUrl å±æ€§
	success: boolean;
	output: string;
	error: string;
	executionTime: number;
	executedAt: string; // æ·»åŠ  executedAt å±æ€§
	createdAt: string;
	vulnId?: string;
	request: string;
	response: string;
	payload: string;
	screenshot?: string;
	params: Record<string, string>;
}

// æ¼æ´æ¨¡å‹
export interface Vulnerability {
	id: string;
	projectId: string;
	taskId: string;
	assetId: string;
	title: string;
	description: string;
	solution: string;
	references: string[];
	cveId: string;
	cweId: string;
	severity: VulnerabilitySeverity;
	status: VulnerabilityStatus;
	type: VulnerabilityType;
	affectedUrl: string;
	affectedHost: string;
	affectedPort: number;
	affectedParam: string;
	payload: string;
	request: string;
	response: string;
	screenshot?: string;
	pocName: string;
	discoveredAt: string;
	verifiedAt?: string;
	fixedAt?: string;
	createdAt: string;
	updatedAt: string;
	createdBy: string;
	updatedBy: string;
	tags: string[];
	customFields: Record<string, any>;
	score: number;
	reproSteps: string;
	notes: string;
}

// æ¼æ´æ‰«æä»»åŠ¡
export interface VulnScanTask {
	id: string;
	projectId: string;
	name: string; // æ·»åŠ  name å±æ€§
	taskName: string;
	target: string; // æ·»åŠ  target å±æ€§
	targets: string[];
	targetType: string;
	status: string;
	createdAt: string;
	startedAt?: string;
	completedAt?: string;
	progress: number;
	config: VulnScanConfig;
	resultSummary: VulnScanSummary;
	error?: string;
	nodeId: string;
	tags: string[];
}

// æ¼æ´æ‰«æé…ç½®
export interface VulnScanConfig {
	pocIds: string[];
	pocCategories: string[];
	concurrency: number;
	timeout: number;
	retryCount: number;
	rateLimit: number;
	followRedirect: boolean;
	customHeaders: Record<string, string>;
	cookies: string;
	proxy: string;
	scanDepth: number;
	saveToDB: boolean;
	verifyVuln: boolean;
	minimumSeverity: VulnerabilitySeverity;
}

// æ¼æ´æ‰«æç»“æœæ‘˜è¦
export interface VulnScanSummary {
	totalTargets: number;
	scannedTargets: number;
	totalVulns: number;
	totalVulnerabilities: number; // æ·»åŠ è¿™ä¸ªå±æ€§ä»¥åŒ¹é…ä½¿ç”¨
	criticalVulns: number;
	highVulns: number;
	highSeverityCount: number; // æ·»åŠ è¿™ä¸ªå±æ€§ä»¥åŒ¹é…ä½¿ç”¨
	mediumVulns: number;
	lowVulns: number;
	infoVulns: number;
	pocSuccessCount: number; // æ·»åŠ è¿™ä¸ªå±æ€§ä»¥åŒ¹é…ä½¿ç”¨
	vulnTypes: Record<string, number>;
}

// POCæ¨¡æ¿ç»“æ„ï¼ˆç”¨äºYAML POCï¼‰
export interface POCTemplate {
	info: {
		name: string;
		author?: string;
		severity: VulnerabilitySeverity;
		description?: string;
		reference?: string[];
		tags?: string[];
	};
	requests: POCRequest[];
	variables?: Record<string, string>;
}

export interface POCRequest {
	method: string;
	path: string;
	headers?: Record<string, string>;
	body?: string;
	matchers: POCMatcher[];
	extractors?: POCExtractor[];
}

export interface POCMatcher {
	type: 'status' | 'word' | 'regex' | 'size';
	status?: number[];
	words?: string[];
	regex?: string[];
	size?: number[];
	condition?: 'and' | 'or';
	part?: 'body' | 'header' | 'all';
}

export interface POCExtractor {
	type: 'regex' | 'xpath' | 'json';
	name: string;
	part: 'body' | 'header';
	group?: number;
	regex?: string[];
	xpath?: string[];
	json?: string[];
}

// ä¸¥é‡æ€§çº§åˆ«æ˜¾ç¤ºé…ç½®
export const SEVERITY_CONFIG = {
	critical: {
		label: 'ä¸¥é‡',
		color: 'red',
		bgColor: 'bg-red-100',
		textColor: 'text-red-800',
		borderColor: 'border-red-200'
	},
	high: {
		label: 'é«˜å±',
		color: 'orange',
		bgColor: 'bg-orange-100',
		textColor: 'text-orange-800',
		borderColor: 'border-orange-200'
	},
	medium: {
		label: 'ä¸­å±',
		color: 'yellow',
		bgColor: 'bg-yellow-100',
		textColor: 'text-yellow-800',
		borderColor: 'border-yellow-200'
	},
	low: {
		label: 'ä½å±',
		color: 'blue',
		bgColor: 'bg-blue-100',
		textColor: 'text-blue-800',
		borderColor: 'border-blue-200'
	},
	info: {
		label: 'ä¿¡æ¯',
		color: 'gray',
		bgColor: 'bg-gray-100',
		textColor: 'text-gray-800',
		borderColor: 'border-gray-200'
	}
} as const;

// çŠ¶æ€æ˜¾ç¤ºé…ç½®
export const STATUS_CONFIG = {
	unverified: {
		label: 'æœªéªŒè¯',
		color: 'gray',
		bgColor: 'bg-gray-100',
		textColor: 'text-gray-800'
	},
	verified: {
		label: 'å·²éªŒè¯',
		color: 'red',
		bgColor: 'bg-red-100',
		textColor: 'text-red-800'
	},
	fixed: {
		label: 'å·²ä¿®å¤',
		color: 'green',
		bgColor: 'bg-green-100',
		textColor: 'text-green-800'
	},
	false_positive: {
		label: 'è¯¯æŠ¥',
		color: 'yellow',
		bgColor: 'bg-yellow-100',
		textColor: 'text-yellow-800'
	},
	ignored: {
		label: 'å·²å¿½ç•¥',
		color: 'gray',
		bgColor: 'bg-gray-100',
		textColor: 'text-gray-800'
	}
} as const;

// ç±»å‹æ˜¾ç¤ºé…ç½®
export const TYPE_CONFIG = {
	web: {
		label: 'Webæ¼æ´',
		icon: 'ğŸŒ'
	},
	system: {
		label: 'ç³»ç»Ÿæ¼æ´',
		icon: 'ğŸ’»'
	},
	network: {
		label: 'ç½‘ç»œæ¼æ´',
		icon: 'ğŸŒ'
	},
	config: {
		label: 'é…ç½®æ¼æ´',
		icon: 'âš™ï¸'
	},
	component: {
		label: 'ç»„ä»¶æ¼æ´',
		icon: 'ğŸ”§'
	}
} as const;

// ä»»åŠ¡çŠ¶æ€é…ç½®
export const TASK_STATUS_CONFIG = {
	pending: {
		label: 'ç­‰å¾…ä¸­',
		color: 'gray',
		bgColor: 'bg-gray-100',
		textColor: 'text-gray-800'
	},
	queued: {
		label: 'å·²å…¥é˜Ÿ',
		color: 'blue',
		bgColor: 'bg-blue-100',
		textColor: 'text-blue-800'
	},
	running: {
		label: 'è¿è¡Œä¸­',
		color: 'yellow',
		bgColor: 'bg-yellow-100',
		textColor: 'text-yellow-800'
	},
	completed: {
		label: 'å·²å®Œæˆ',
		color: 'green',
		bgColor: 'bg-green-100',
		textColor: 'text-green-800'
	},
	failed: {
		label: 'å¤±è´¥',
		color: 'red',
		bgColor: 'bg-red-100',
		textColor: 'text-red-800'
	},
	canceled: {
		label: 'å·²å–æ¶ˆ',
		color: 'gray',
		bgColor: 'bg-gray-100',
		textColor: 'text-gray-800'
	},
	timeout: {
		label: 'è¶…æ—¶',
		color: 'orange',
		bgColor: 'bg-orange-100',
		textColor: 'text-orange-800'
	}
} as const;
